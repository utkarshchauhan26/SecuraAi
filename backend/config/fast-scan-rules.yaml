rules:
  - id: hardcoded-password
    pattern: password = "..."
    message: Hardcoded password detected
    severity: ERROR
    languages: [javascript, typescript, python, java]
    
  - id: hardcoded-secret-string
    pattern-regex: (password|passwd|secret|apiKey|api_key|token)\s*=\s*[\"'][a-zA-Z0-9_-]{8,}[\"']
    message: Hardcoded credential detected in source code
    severity: ERROR
    languages: [javascript, typescript, python, java]
    
  - id: sql-injection-concat
    pattern: |
      $DB.query("..." + $INPUT + "...")
    message: Possible SQL injection vulnerability
    severity: ERROR
    languages: [javascript, typescript]
    
  - id: sql-injection-template
    pattern: |
      $DB.query(`...${$INPUT}...`)
    message: Possible SQL injection via template string
    severity: ERROR
    languages: [javascript, typescript]
    
  - id: xss-inner-html
    pattern: innerHTML = $INPUT
    message: Possible XSS vulnerability - avoid innerHTML
    severity: WARNING
    languages: [javascript, typescript]
    
  - id: xss-dangerously-set
    pattern: dangerouslySetInnerHTML
    message: Possible XSS vulnerability - dangerouslySetInnerHTML
    severity: WARNING
    languages: [javascript, typescript]
    
  - id: eval-usage
    pattern-either:
      - pattern: eval($INPUT)
      - pattern: Function($INPUT)
    message: Use of eval() is dangerous
    severity: ERROR
    languages: [javascript, typescript]
    
  - id: exec-usage
    pattern-either:
      - pattern: eval(...)
      - pattern: exec(...)
    message: Use of eval/exec is dangerous
    severity: ERROR
    languages: [python]
    
  - id: api-key-exposure
    pattern-regex: (api[_-]?key|apikey|api[_-]?secret|sk_live)\s*=\s*[\"'][a-zA-Z0-9_-]{20,}[\"']
    message: Possible API key exposure
    severity: ERROR
    languages: [javascript, typescript, python, java, go]
    
  - id: command-injection
    pattern-either:
      - pattern: child_process.exec($INPUT, ...)
      - pattern: require("child_process").exec($INPUT, ...)
    message: Possible command injection
    severity: ERROR
    languages: [javascript, typescript]
    
  - id: weak-crypto
    pattern-either:
      - pattern: crypto.createHash("md5")
      - pattern: crypto.createHash("sha1")
    message: Weak cryptographic algorithm - use SHA-256 or stronger
    severity: WARNING
    languages: [javascript, typescript]
    
  - id: console-log
    pattern: console.log(...)
    message: Console statement detected - remove in production
    severity: INFO
    languages: [javascript, typescript]
    
  - id: todo-comment
    pattern-regex: (TODO|FIXME|HACK|XXX)
    message: Unresolved TODO/FIXME comment
    severity: INFO
    languages: [javascript, typescript, python, java]
    
  - id: empty-catch
    pattern: |
      try { ... } catch($ERR) { }
    message: Empty catch block swallows errors
    severity: INFO
    languages: [javascript, typescript]
  # Security Architecture Patterns
  - id: missing-rate-limiter
    pattern-not: |
      require('express-rate-limit')
    pattern: |
      const $APP = express()
    message: Application may be missing rate limiting protection - consider using express-rate-limit
    severity: ERROR
    languages: [javascript, typescript]
    metadata:
      category: security
      cwe: "CWE-770: Allocation of Resources Without Limits or Throttling"
      owasp: "API4:2023 Unrestricted Resource Consumption"
      impact: HIGH
      likelihood: HIGH
      
  - id: unsafe-cors-wildcard
    pattern-either:
      - pattern: cors({origin:"*",...})
      - pattern: cors({origin:'*',...})
      - pattern: |
          $APP.use(cors({origin:"*"}))
    message: CORS configured with wildcard (*) - allows any origin to access API
    severity: ERROR
    languages: [javascript, typescript]
    metadata:
      category: security
      cwe: "CWE-346: Origin Validation Error"
      owasp: "A05:2021 Security Misconfiguration"
      
  - id: jwt-no-verify
    pattern-either:
      - pattern: jwt.decode($TOKEN)
      - pattern: $JWT.decode($TOKEN, {verify:false,...})
    message: JWT decoded without verification - attacker can forge tokens
    severity: ERROR
    languages: [javascript, typescript]
    metadata:
      category: security
      cwe: "CWE-347: Improper Verification of Cryptographic Signature"
      owasp: "A02:2021 Cryptographic Failures"
      
  - id: missing-input-validation
    pattern: |
      router.$METHOD($PATH, async ($REQ, $RES) => {
        ...
        $DATA = $REQ.body
        ...
      })
    pattern-not-inside: |
      router.$METHOD($PATH, $VALIDATOR, ...)
    message: Route handler may be missing input validation middleware
    severity: WARNING
    languages: [javascript, typescript]
    metadata:
      category: security
      cwe: "CWE-20: Improper Input Validation"
      owasp: "A03:2021 Injection"
      
  - id: env-variable-logged
    pattern-either:
      - pattern: console.log(..., process.env.$VAR, ...)
      - pattern: logger.log(..., process.env.$VAR, ...)
      - pattern: console.error(..., process.env.$VAR, ...)
    message: Environment variable logged - may expose secrets in logs
    severity: WARNING
    languages: [javascript, typescript]
    metadata:
      category: security
      cwe: "CWE-532: Information Exposure Through Log Files"
      
  - id: missing-helmet
    pattern: |
      const $APP = express()
    pattern-not: |
      require('helmet')
    message: Application missing Helmet.js security headers
    severity: WARNING
    languages: [javascript, typescript]
    metadata:
      category: security
      owasp: "A05:2021 Security Misconfiguration"
      
  - id: unsafe-file-upload
    pattern-either:
      - pattern: multer({dest:$PATH})
      - pattern: multer()
    pattern-not-inside: |
      multer({
        ...
        limits: {...},
        fileFilter: $FILTER,
        ...
      })
    message: File upload without size limits or file type validation
    severity: WARNING
    languages: [javascript, typescript]
    metadata:
      category: security
      cwe: "CWE-434: Unrestricted Upload of File with Dangerous Type"
      owasp: "A04:2021 Insecure Design"
      
  - id: private-key-in-code
    pattern-regex: -----BEGIN\s+(RSA\s+)?PRIVATE\s+KEY-----
    message: Private cryptographic key embedded in source code
    severity: ERROR
    languages: [javascript, typescript, python, java, go]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A07:2021 Identification and Authentication Failures"
      
  - id: aws-access-key
    pattern-regex: AKIA[0-9A-Z]{16}
    message: AWS Access Key ID detected in source code
    severity: ERROR
    languages: [javascript, typescript, python, java, go]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      
  - id: github-token
    pattern-regex: gh[pousrt]_[a-zA-Z0-9]{36,255}
    message: GitHub personal access token detected
    severity: ERROR
    languages: [javascript, typescript, python, java, go]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      
  - id: insecure-random
    pattern-either:
      - pattern: Math.random()
      - pattern: new Date().getTime()
    pattern-inside: |
      function $FUNC(...) {
        ...
      }
    pattern-not-inside: |
      function $MATH(...) {
        ...
      }
    message: Insecure random number generation - use crypto.randomBytes() for security-sensitive operations
    severity: WARNING
    languages: [javascript, typescript]
    metadata:
      category: security
      cwe: "CWE-338: Use of Cryptographically Weak PRNG"
      
  - id: unencrypted-communication
    pattern-either:
      - pattern: http.request($URL, ...)
      - pattern: axios.get("http://...", ...)
      - pattern: fetch("http://...", ...)
    message: Unencrypted HTTP communication detected - use HTTPS
    severity: WARNING
    languages: [javascript, typescript]
    metadata:
      category: security
      cwe: "CWE-319: Cleartext Transmission of Sensitive Information"
      owasp: "A02:2021 Cryptographic Failures"